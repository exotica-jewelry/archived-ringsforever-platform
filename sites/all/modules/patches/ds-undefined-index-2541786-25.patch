From 43848ed22bcb161a8820a69ea256a5ff4209051f Mon Sep 17 00:00:00 2001
From: aspilicious
Date: Fri, 27 Nov 2015 19:37:01 +0100
Subject: Issue #2541786 by aspilicious: Changing layout to "fluid 2 columns
 stacked" resulted in crash

---
 includes/ds.field_ui.inc | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/includes/ds.field_ui.inc b/includes/ds.field_ui.inc
index ec3779f..153fb14 100644
--- a/includes/ds.field_ui.inc
+++ b/includes/ds.field_ui.inc
@@ -774,6 +774,9 @@ function ds_field_ui_layouts_save($form, &$form_state) {
     if (isset($form_state['values']['additional_settings']['preview']['info']['settings']['disable_css'])) {
       $record->settings['layout_disable_css'] = $form_state['values']['additional_settings']['preview']['info']['settings']['disable_css'];
     }
+    else {
+      $record->settings['layout_disable_css'] = FALSE;
+    }
 
     $record->settings = $record->settings;
 
@@ -1940,9 +1943,6 @@ function _ds_field_ui_table_layouts_preview(&$form, &$form_state, $ds_layouts, $
         if (isset($layout->settings['layout_disable_css'])) {
           $disable_css = $layout->settings['layout_disable_css'];
         }
-        if (isset($form_state['values']) && $disable_css !== $form_state['values']['additional_settings']['ds_layouts']['preview']['info']['settings']['disable_css']) {
-          $disable_css = $form_state['values']['additional_settings']['ds_layouts']['preview']['info']['settings']['disable_css'];
-        }
 
         $form['additional_settings']['ds_layouts']['preview']['info']['settings']['disable_css'] = array(
           '#type' => 'checkbox',
-- 
cgit v0.11.2

